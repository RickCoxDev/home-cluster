---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: homer
  namespace: home
spec:
  interval: 5m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: homer
      version: 5.2.0
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home
        namespace: flux-system
      interval: 5m
  install:
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
      remediateLastFailure: true
      # cleanupOnFail: true
  rollback:
    timeout: 10m
    recreate: true
    # cleanupOnFail: true
  values:
    image:
      repository: b4bz/homer
      tag: 21.03.2
    persistence:
      config:
        enabled: true
        storageClass: nfs-kube
    ingress:
      main:
        enabled: true
        annotations:
          kubernetes.io/ingress.class: "external"
        hosts:
          - host: "homer.${DOMAIN}"
            paths:
              - path: /
                pathType: Prefix
        tls:
          - hosts:
              - "homer.${DOMAIN}"
    env:
      TZ: America/Chicago
    configmap:
      enabled: true
      config: |
        ---
        title: "Home Dashboard"
        icon: "fas fa-home"
        theme: default
        footer: ""
        colors:
          light:
            highlight-primary: "#3367d6"
            highlight-secondary: "#4285f4"
            highlight-hover: "#5a95f5"
            background: "#f5f5f5"
            card-background: "#ffffff"
            text: "#363636"
            text-header: "#ffffff"
            text-title: "#303030"
            text-subtitle: "#424242"
            card-shadow: rgba(0, 0, 0, 0.1)
            link-hover: "#363636"
          dark:
            highlight-primary: "#3367d6"
            highlight-secondary: "#4285f4"
            highlight-hover: "#5a95f5"
            background: "#131313"
            card-background: "#2b2b2b"
            text: "#eaeaea"
            text-header: "#ffffff"
            text-title: "#fafafa"
            text-subtitle: "#f5f5f5"
            card-shadow: rgba(0, 0, 0, 0.4)
            link-hover: "#ffdd57"
        tags:
          Disabled: &Disabled
            - tag: "Disabled"
              tagstyle: "is-danger"
        links:
          - name: "Github"
            icon: "fab fa-github"
            url: "https://github.com/RickCoxDev/home-cluster"
            target: "_blank"
            title: "Github Repo"
        services:
          - name: "Internal Applications"
            icon: "fas fa-network-wired"
            items:
              - name: "Node-Red"
                url: "https://red.internal.${DOMAIN}"
                target: "_blank"
                icon: "fas fa-project-diagram"
                type: "Ping"
              - name: "Pihole"
                url: "https://pihole.internal.${DOMAIN}/admin"
                target: "_blank"
                icon: "fas fa-shield-alt"
                type: "PiHole"
              - name: "Jackett"
                url: "https://jackett.internal.${DOMAIN}"
                <<: *Disabled
                target: "_blank"
                icon: "fas fa-user-secret"
                type: "Ping"
              - name: "Sonarr"
                url: "https://sonarr.internal.${DOMAIN}"
                <<: *Disabled
                target: "_blank"
                icon: "fas fa-tv"
                type: "Ping"
              - name: "Radarr"
                url: "https://radarr.internal.${DOMAIN}"
                <<: *Disabled
                target: "_blank"
                icon: "fas fa-film"
                type: "Ping"
              - name: "Readarr"
                url: "https://readarr.internal.${DOMAIN}"
                <<: *Disabled
                target: "_blank"
                icon: "fas fa-book"
                type: "Ping"
              - name: "OpenMediaVault"
                url: "http://192.168.1.105"
                target: "_blank"
                icon: "fas fa-hdd"
                type: "Ping"
          - name: "External Applications"
            icon: "fas fa-cloud"
            items:
              - name: "Home Assistant"
                url: "https://${DOMAIN}"
                target: "_blank"
                icon: "fas fa-house-user"
                type: "Ping"
              - name: "Plex"
                url: "https://app.plex.tv"
                target: "_blank"
                icon: "fas fa-video"
                type: "Ping"
              - name: "Ombi"
                url: "https://ombi.${DOMAIN}"
                target: "_blank"
                icon: "fas fa-link"
                type: "Ping"
              - name: "Calibre"
                url: "https://calibre.${DOMAIN}"
                target: "_blank"
                icon: "fas fa-book-reader"
                type: "Ping"
              - name: "Booksonic"
                url: "https://booksonic.${DOMAIN}"
                target: "_blank"
                icon: "fas fa-podcast"
                type: "Ping"
              - name: "FreshRSS"
                url: "https://rss.${DOMAIN}"
                target: "_blank"
                icon: "fas fa-rss"
                type: "Ping"
              - name: "Bitwarden"
                url: "https://vault.${DOMAIN}"
                target: "_blank"
                icon: "fas fa-lock"
                type: "Ping"
              - name: "Grocy"
                url: "https://grocy.${DOMAIN}"
                target: "_blank"
                icon: "fas fa-shopping-cart"
                type: "Ping"
              - name: "OpenFaaS"
                url: "https://openfaas.mysmarthome.space"
                <<: *Disabled
                target: "_blank"
                icon: "fas fa-atom"
                type: "Ping"
